<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>图像处理</title>


</head>

<body>

</body>

<script>

    var allImage = [
        // {
        //     file: '1.jpg', picList: [
        //         { x1: 66, y1: 26, x2: 75, y2: 56, name: 'mao' },
        //         { x1: 75, y1: 26, x2: 96, y2: 56, name: '3' },
        //         { x1: 96, y1: 26, x2: 117, y2: 56, name: '8' }
        //     ]
        // },
        {
            file: '2.jpg', picList: [
                // { x1: 75, y1: 26, x2: 97, y2: 56, name: '4' },
                // { x1: 97, y1: 26, x2: 117, y2: 56, name: '0' },
                // { x1: 339, y1: 460, x2: 399, y2: 535, name: 'z_3' },
                // { x1: 399, y1: 460, x2: 450, y2: 535, name: 'z_7' },
                // { x1: 450, y1: 460, x2: 477, y2: 543, name: 'z_dou' },
                // { x1: 477, y1: 460, x2: 531, y2: 535, name: 'z_0' },
                // { x1: 531, y1: 460, x2: 584, y2: 535, name: 'z_6' },
                // { x1: 584, y1: 460, x2: 634, y2: 535, name: 'z_9' },//宽度偏小
                // { x1: 634, y1: 460, x2: 658, y2: 535, name: 'z_dian' },
                // { x1: 658, y1: 460, x2: 714, y2: 535, name: 'z_8' },
                // { x1: 230, y1: 914, x2: 256, y2: 953, name: 'b_9' },
                // { x1: 256, y1: 914, x2: 283, y2: 953, name: 'b_5' },
                // { x1: 283, y1: 914, x2: 311, y2: 953, name: 'b_3' },
                // { x1: 311, y1: 914, x2: 324, y2: 953, name: 'b_dian' },
                // { x1: 325, y1: 914, x2: 355, y2: 953, name: 'b_4' },

                // { x1: 554, y1: 592, x2: 584, y2: 678, name: 's_6' },
                // { x1: 584, y1: 592, x2: 596, y2: 678, name: 's_dian' },
                // { x1: 596, y1: 592, x2: 616, y2: 678, name: 's_1' },
                // { x1: 618, y1: 592, x2: 650, y2: 678, name: 's_4' },

                // { x1: 750, y1: 914, x2: 778, y2: 953, name: 'n_6' },
                // { x1: 778, y1: 914, x2: 802, y2: 953, name: 'n_7' },
                // { x1: 830, y1: 914, x2: 856, y2: 953, name: 'n_0' },

                //  { x1: 197, y1: 20, x2: 234, y2: 60, name: 'zhifubao' },
                //  { x1: 248, y1: 20, x2: 287, y2: 60, name: 'tonghuashun' },
            ]
        },
        {
            file: '3.jpg', picList: [

                // { x1: 96, y1: 26, x2: 117, y2: 56, name: '2' },

                // { x1: 531, y1: 460, x2: 589, y2: 535, name: 'z_4' },
                // { x1: 589, y1: 460, x2: 623, y2: 535, name: 'z_1' },

                // { x1: 263, y1: 914, x2: 289, y2: 953, name: 'b_7' },
                // { x1: 289, y1: 914, x2: 306, y2: 953, name: 'b_1' },
                // { x1: 350, y1: 914, x2: 377, y2: 953, name: 'b_6' },

                // { x1: 596, y1: 592, x2: 625, y2: 678, name: 's_2' },
                // { x1: 625, y1: 592, x2: 644, y2: 678, name: 's_1' },//前面已经有一个1

                // { x1: 718, y1: 914, x2: 731, y2: 953, name: 'n_1' },//年利率基本固定是1，前面部分没有空白
                // { x1: 731, y1: 914, x2: 747, y2: 953, name: 'n_dian' },
                // { x1: 750, y1: 914, x2: 778, y2: 953, name: 'n_6' },
                // { x1: 776, y1: 914, x2: 802, y2: 953, name: 'n_8' },
                // { x1: 802, y1: 914, x2: 830, y2: 953, name: 'n_3' },
                // { x1: 830, y1: 914, x2: 858, y2: 953, name: 'n_0' },
                // { x1: 194, y1: 20, x2: 234, y2: 60, name: 'hello' },
            ]
        },
        {
            file: '4.jpg', picList: [
                // { x1: 1011, y1: 22, x2: 1031, y2: 58, name: 'battery1' },
                // { x1: 117, y1: 26, x2: 139, y2: 56, name: '5' },
                // { x1: 162, y1: 20, x2: 198, y2: 60, name: 'wx' },
                // { x1: 214, y1: 20, x2: 254, y2: 60, name: 'csdn' },
                // { x1: 270, y1: 20, x2: 310, y2: 60, name: 'wg' }
            ]
        },
        {
            file: '5.jpg', picList: [
                // { x1: 97, y1: 26, x2: 117, y2: 56, name: '9' },
                // { x1: 304, y1: 20, x2: 344, y2: 60, name: 'tb' },
                // { x1: 1011, y1: 22, x2: 1031, y2: 58, name: 'battery2' },
            ]
        },
        {
            file: '6.jpg', picList: [
                // { x1: 97, y1: 26, x2: 117, y2: 56, name: '6' },
                // { x1: 1011, y1: 22, x2: 1031, y2: 58, name: 'battery3' },
            ]
        },
        {
            file: '7.jpg', picList: [
                // { x1: 96, y1: 26, x2: 112, y2: 56, name: '1' },
                // { x1: 45, y1: 26, x2: 66, y2: 56, name: '7' },
                // { x1: 1011, y1: 22, x2: 1031, y2: 58, name: 'battery0' },
            ]
        },
        {
            file: '8.jpg', picList: [
                // { x1: 406, y1: 460, x2: 460, y2: 535, name: 'z_5' },
                // { x1: 650, y1: 460, x2: 706, y2: 535, name: 'z_2' },


                // { x1: 256, y1: 914, x2: 283, y2: 953, name: 'b_8' },

                // { x1: 804, y1: 914, x2: 830, y2: 953, name: 'n_9' },
            ]
        },
        {
            file: '9.jpg', picList: [
                // { x1: 242, y1: 914, x2: 269, y2: 953, name: 'b_2' },//特殊
                // { x1: 340, y1: 914, x2: 366, y2: 953, name: 'b_0' },

                //  { x1: 620, y1: 592, x2: 647, y2: 678, name: 's_3' },

                // { x1:326 , y1: 592, x2: 360, y2: 678, name: 's_L' },//左边圆
                // { x1:360 , y1: 592, x2: 555, y2: 678, name: 's_F' },//字体
                // { x1:648 , y1: 592, x2: 722, y2: 678, name: 's_Y' },//元字体
                // { x1:722 , y1: 592, x2: 756, y2: 678, name: 's_R' },//右边圆
            ]
        },
        {
            file: '10.jpg', picList: [
                // { x1: 142, y1: 20, x2: 176, y2: 60, name: 'qq' },
            ]
        },
        {
            file: '11.jpg', picList: [
            ]
        },
        {
            file: '12.jpg', picList: [
                // { x1: 597, y1: 592, x2: 624, y2: 678, name: 's_7' },
                // { x1: 624, y1: 592, x2: 650, y2: 678, name: 's_7' },//
            ]
        },
        {
            file: '13.jpg', picList: [
                // { x1: 595, y1: 592, x2: 622, y2: 678, name: 's_7' },
                // { x1: 622, y1: 592, x2: 650, y2: 678, name: 's_5' },
            ]
        },
        {
            file: '14.jpg', picList: [
                { x1: 593, y1: 592, x2: 621, y2: 678, name: 's_8' },
                { x1: 621, y1: 592, x2: 648, y2: 678, name: 's_9' },
            ]
        },
        {
            file: '15.jpg', picList: [
                // { x1: 595, y1: 592, x2: 622, y2: 678, name: 's_8' },
                { x1: 623, y1: 592, x2: 651, y2: 678, name: 's_0' },
            ]
        },
    ]

    function downloadImage(allImage) {
        if (allImage.length == 0) {
            return
        }
        const f = allImage.shift();
        var pic = document.createElement("canvas");
        var ctx = pic.getContext("2d");

        var myImage = new Image();
        myImage.src = f.file;    //背景图片  你自己本地的图片或者在线图片
        myImage.crossOrigin = 'Anonymous';

        var picList = f.picList
        myImage.onload = () => {
            pic.width = myImage.width;
            pic.height = myImage.height;
            ctx.drawImage(myImage, 0, 0)
            for (let i = 0; i < picList.length; i++) {
                const p = picList[i];
                var imageData = ctx.getImageData(p.x1, p.y1, p.x2 - p.x1, p.y2 - p.y1)
                var canvas = document.createElement("canvas");
                var context = canvas.getContext("2d");
                canvas.width = imageData.width
                canvas.height = imageData.height
                context.putImageData(imageData, 0, 0)
                var url = canvas.toDataURL('image/png')
                var a = document.createElement('a')
                // 创建一个单击事件
                var event = new MouseEvent('click')

                // 将a的download属性设置为我们想要下载的图片名称，若name不存在则使用‘下载图片名称’作为默认名称
                a.download = p.name
                // 将生成的URL设置为a.href属性
                a.href = url

                // 触发a的单击事件
                a.dispatchEvent(event)

                document.body.appendChild(canvas)
            }
            downloadImage(allImage)
        }

    }

    downloadImage(allImage)


</script>


</html>